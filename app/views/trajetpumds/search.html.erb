<script src="//maps.google.com/maps/api/js?v=3.exp&key=AIzaSyBngIsRw-Abk5UB04-Nl_Qg4vACEfo2jEo"></script>
<div class="searchpage">

<h1 class="text-center searchtitle">Les pickeurs autour de vous</h1>

  <aside class="markersbloc hidden-xs hidden-sm">
    <ul id="markerslist" class="list-unstyled"></ul>
  </aside>

      <div id="mapcontainer">
        <div id="map"></div>
      </div>
</div>


          <script type="text/javascript">
          var pickers = <%= @pickers %>;
          var pickerscoord = <%= @pickerscoord %>;
          var avatars = <%= raw @pickersavatars %>;
          var infotrajets = <%=raw @trajetsdata %>;
          var ul = document.getElementById("markerslist");
          function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        <% if user_signed_in? %>
        center: {lat: <%= current_user.latitude %>, lng: <%= current_user.longitude %>}
        <%else %>
        center: {lat: <%= @client.latitude %>, lng: <%= @client.longitude %>}
        <% end %>
      });

      setMarkers(map);
    }

    // Data for the markers consisting of a name, a LatLng and a zIndex for the
    // order in which these markers should display on top of each other.



    function setMarkers(map) {

      <%=  @pickers.count.times do |i| %>
          var i = <%= i %>;
          var pcoord = pickerscoord[i];
          var contentString = infotrajets[i];
          var image = {
            url: avatars[i].replace(/&quot;/g, '\\"'),
            // This marker is 20 pixels wide by 32 pixels high.
            size: new google.maps.Size(35, 35),
            // The origin for this image is (0, 0).
            origin: new google.maps.Point(0, 0),
            // The anchor for this image is the base of the flagpole at (0, 32).
            anchor: new google.maps.Point(0, 32)
          };
          var marker<%= i %> = new google.maps.Marker({
            position: {lat: pcoord[0], lng: pcoord[1]},
            map: map,
            icon: image,
          });
          var infowindow<%= i %> = new google.maps.InfoWindow({
            content: contentString
          });

          function createMarkerButton(marker) {
            //Creates a sidebar button
            var li<%= i %> = document.createElement("li");
            li<%= i %>.setAttribute("id", "itemlist<%= i %>");
            li<%= i %>.innerHTML = "<div class='container-fluide'><div class='row'>" + contentString + "</div></div>";
            ul.appendChild(li<%= i %>);
            console.log( li<%= i %>)

            //Trigger a click event to marker when the button is clicked.
            google.maps.event.addDomListener(li<%= i %>, "click", function(){
              google.maps.event.trigger(marker, "click");
            });
          };

          google.maps.event.addListener(marker<%= i %>, "click", function(){
            infowindow<%= i %>.open(map, marker<%= i %>);
          });
          if (i>0){
            createMarkerButton(marker<%= i %>);
          }
      <%   end%>
    };
initMap();
$('.gm-style-iw').addClass("container-fluid");
$('.gm-style-iw div').addClass("row");
          </script>



  </div>
  </div>


</div>
</div>
